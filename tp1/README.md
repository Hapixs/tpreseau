# TP1 : MaÃ®trise rÃ©seau du poste
- [TP1 : MaÃ®trise rÃ©seau du poste](#tp1--maÃ®trise-rÃ©seau-du-poste)
- [I. Basics](#i-basics)
- [II. Go further](#ii-go-further)
- [III. Le requin](#iii-le-requin)

# I. Basics

> Tout est Ã  faire en ligne de commande, sauf si prÃ©cision contraire.

â˜€ï¸ **Carte rÃ©seau WiFi**

DÃ©terminer...

- l'adresse MAC de votre carte WiFi
```bash
[hd0@localhost tpreseau]$ ip a | grep link/ether
    link/ether 08:00:27:06:9f:50 brd ff:ff:ff:ff:ff:ff
```
- l'adresse IP de votre carte WiFi
```bash
[hd0@localhost tpreseau]$ ip a |grep inet
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic noprefixroute enp0s3
```
- le masque de sous-rÃ©seau du rÃ©seau LAN auquel vous Ãªtes connectÃ©s en WiFi
  - en notation CIDR: `/24`
  - ET en notation dÃ©cimale, par exemple `255.255.255.0`
---

â˜€ï¸ **DÃ©so pas dÃ©so**

Pas besoin d'un terminal lÃ , juste une feuille, ou votre tÃªte, ou un tool qui calcule tout hihi. DÃ©terminer...

- l'adresse de rÃ©seau du LAN auquel vous Ãªtes connectÃ©s en cWiFi: `10.0.2.1`
- l'adresse de broadcast: `10.0.2.255`
- le nombre d'adresses IP disponibles dans ce rÃ©seau: `254`

---

â˜€ï¸ **Hostname**

- dÃ©terminer le hostname de votre PC
```bash
[hd0@localhost tpreseau]$ hostname
localhost.localdomain
```

---

â˜€ï¸ **Passerelle du rÃ©seau**

DÃ©terminer...

- l'adresse IP de la passerelle du rÃ©seau
```bash
[hd0@localhost tpreseau]$ ip route | grep enp0s3
10.0.2.0/24 dev enp0s3 proto kernel scope link src 10.0.2.15 metric 100
```
- l'adresse MAC de la passerelle du rÃ©seau
```bash
[hd0@localhost tpreseau]$ arp | grep gateway
_gateway                 ether   52:54:00:12:35:02   C                     enp0s3
```

---

â˜€ï¸ **Serveur DHCP et DNS**

DÃ©terminer...

- l'adresse IP du serveur DHCP qui vous a filÃ© une IP
```
[...]
DHCPOFFER of 10.0.2.15 from 10.0.2.2
```
- l'adresse IP du serveur DNS que vous utilisez quand vous allez sur internet
```
[hd0@localhost tpreseau]$ cat /etc/resolv.conf
# Generated by NetworkManager
nameserver 8.8.8.8
nameserver 1.1.1.1
```

---

â˜€ï¸ **Table de routage**

DÃ©terminer...

- dans votre table de routage, laquelle est la route par dÃ©faut
```
[hd0@localhost tpreseau]$ ip route | grep default
default via 10.0.2.2 dev enp0s3
default via 10.0.2.2 dev enp0s3 proto dhcp src 10.0.2.15 metric 100
```
---

![Not sure](./img/notsure.png)

# II. Go further

> Toujours tout en ligne de commande.

---

â˜€ï¸ **Hosts ?**

- faites en sorte que pour votre PC, le nom `b2.hello.vous` corresponde Ã  l'IP `1.1.1.1`
- prouvez avec un `ping b2.hello.vous` que Ã§a ping bien `1.1.1.1`

```bash
[hd0@localhost tpreseau]$ cat /etc/hosts; ping b2.hello.vous -c 1
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
1.1.1.1     b2.hello.vous
PING b2.hello.vous (1.1.1.1) 56(84) bytes of data.
64 bytes from b2.hello.vous (1.1.1.1): icmp_seq=1 ttl=56 time=13.9 ms

--- b2.hello.vous ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 13.886/13.886/13.886/0.000 ms
```
---

â˜€ï¸ **Go mater une vidÃ©o youtube et dÃ©terminer, pendant qu'elle tourne...**

- l'adresse IP du serveur auquel vous Ãªtes connectÃ©s pour regarder la vidÃ©o

> En utilisant wireshark on trouve l'ip suivante: 91.68.245.16

- le port du serveur auquel vous Ãªtes connectÃ©s

> Le port utilisÃ© est 443 (HTTPS)

- le port que votre PC a ouvert en local pour se connecter au port du serveur distant
> Le port local utilisÃ©: 55538


Screen:
![alt text](https://github.com/Hapixs/personaluseimages/blob/main/wireshark%20screen%20tp1.PNG?raw=true)

> Il est **fortement** recommandÃ© de couper toutes vos[autres connexions internet pour identifier facilement ce trafic (fermez Discord, tous les onglets de vos navigateurs ouverts, etc. Fermez tout ce qui sollicite le rÃ©seau.

---

â˜€ï¸ **RequÃªtes DNS**

DÃ©terminer...

- Ã  quelle adresse IP correspond le nom de domaine `www.ynov.com`
```
[hd0@localhost ~]$ dig www.ynov.com
[...]
;; ANSWER SECTION:
www.ynov.com.           300     IN      A       172.67.74.226
www.ynov.com.           300     IN      A       104.26.11.233
www.ynov.com.           300     IN      A       104.26.10.233 <----- l'ip en question
[...]
```

- Ã  quel nom de domaine correspond l'IP `174.43.238.89`
```
[hd0@localhost ~]$ dig -x 174.43.238.89
[...]
;; ANSWER SECTION:
89.238.43.174.in-addr.arpa. 7200 IN     PTR     89.sub-174-43-238.myvzw.com. <---- le nom de domaine
```
---

â˜€ï¸ **Hop hop hop**

DÃ©terminer...

- par combien de machines vos paquets passent quand vous essayez de joindre `www.ynov.com`

(Le traceroute de ma vm affiche des text sacrÃ©e qui date de plusieurs millier d'annÃ©e du coup je passe avec windows pour cette question :) )
```
C:\Users\Miste>tracert www.ynov.com
  1     3 ms     1 ms     1 ms  10.33.79.254
  2     2 ms     3 ms     3 ms  145.117.7.195.rev.sfr.net [195.7.117.145]
  3    98 ms     3 ms     3 ms  237.195.79.86.rev.sfr.net [86.79.195.237]
  4     4 ms     2 ms     3 ms  196.224.65.86.rev.sfr.net [86.65.224.196]
  5    12 ms    11 ms    11 ms  12.148.6.194.rev.sfr.net [194.6.148.12]
  6     *       10 ms    10 ms  12.148.6.194.rev.sfr.net [194.6.148.12]
  7    10 ms    11 ms    16 ms  141.101.67.48
  8    12 ms    10 ms    12 ms  172.71.124.4
  9    11 ms    10 ms    10 ms  172.67.74.226
```
> Les paquets passent par 9 machines quand on joint ``www.ynov.com`

---

â˜€ï¸ **IP publique**

DÃ©terminer...

- l'adresse IP publique de la passerelle du rÃ©seau (le routeur d'YNOV donc si vous Ãªtes dans les locaux d'YNOV quand vous faites le TP)
> En utilisant `https://whatismyipaddress.com/fr/mon-ip` il nous affiche `195.7.117.146`
---

â˜€ï¸ **Scan rÃ©seau**

DÃ©terminer...

- combien il y a de machines dans le LAN auquel vous Ãªtes connectÃ©s
```
[hd0@localhost ~]$ sudo nmap -sn 10.0.2.0/24
Starting Nmap 7.91 ( https://nmap.org ) at 2023-10-25 14:24 CEST
Nmap scan report for 10.0.2.2
Host is up (0.00047s latency).
MAC Address: 52:54:00:12:35:02 (QEMU virtual NIC)
Nmap scan report for 10.0.2.3
Host is up (0.00048s latency).
MAC Address: 52:54:00:12:35:03 (QEMU virtual NIC)
Nmap scan report for 10.0.2.4
Host is up (0.0010s latency).
MAC Address: 52:54:00:12:35:04 (QEMU virtual NIC)
Nmap scan report for 10.0.2.15
Host is up.
Nmap done: 256 IP addresses (4 hosts up) scanned in 2.14 seconds
```

> 4 Machine sont en ligne actuelement
> (et maintenant je part en prison)

![Stop it](./img/stop.png)

# III. Le requin

Faites chauffer Wireshark. Pour chaque point, je veux que vous me livrez une capture Wireshark, format `.pcap` donc.

Faites *clean* ğŸ§¹, vous Ãªtes des grands now :

- livrez moi des captures rÃ©seau avec uniquement ce que je demande et pas 40000 autres paquets autour
  - vous pouvez sÃ©lectionner seulement certains paquets quand vous enregistrez la capture dans Wireshark
- stockez les fichiers `.pcap` dans le dÃ©pÃ´t git et cÃ´tÃ© rendu Markdown, vous me faites un lien vers le fichier, c'est cette syntaxe :

```markdown
[Lien vers capture ARP](./captures/arp.pcap)
```

---

â˜€ï¸ **Capture ARP**

- ğŸ“ fichier `arp.pcap`
- capturez un Ã©change ARP entre votre PC et la passerelle du rÃ©seau

> Si vous utilisez un filtre Wireshark pour mieux voir ce trafic, prÃ©cisez-le moi dans le compte-rendu.

---

â˜€ï¸ **Capture DNS**

- ğŸ“ fichier `dns.pcap`
- capturez une requÃªte DNS vers le domaine de votre choix et la rÃ©ponse
- vous effectuerez la requÃªte DNS en ligne de commande

> Si vous utilisez un filtre Wireshark pour mieux voir ce trafic, prÃ©cisez-le moi dans le compte-rendu.

---

â˜€ï¸ **Capture TCP**

- ğŸ“ fichier `tcp.pcap`
- effectuez une connexion qui sollicite le protocole TCP
- je veux voir dans la capture :
  - un 3-way handshake
  - un peu de trafic
  - la fin de la connexion TCP

> Si vous utilisez un filtre Wireshark pour mieux voir ce trafic, prÃ©cisez-le moi dans le compte-rendu.

---

![Packet sniffer](img/wireshark.jpg)

> *Je sais que je vous l'ai dÃ©jÃ  servi l'an dernier lui, mais j'aime trop ce meme hihi ğŸˆ*
